<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n tr·ªã s√°ch | BookReader</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/admin-books.css">
    <link rel="stylesheet" href="../css/admin-books-sections.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
    <!-- Admin Sidebar Navigation -->
    <aside class="admin-sidebar">
        <div class="admin-sidebar__header">
            <a href="index.html" class="admin-logo">
                <i class="fas fa-book-open"></i>
                <span>BookReader Admin</span>
            </a>
        </div>
        <nav class="admin-sidebar__nav">
            <a href="admin-dashboard.html" class="admin-nav-item">
                <i class="fas fa-chart-line"></i>
                <span>B·∫£ng ƒëi·ªÅu khi·ªÉn</span>
            </a>
            <a href="admin-books.html" class="admin-nav-item active">
                <i class="fas fa-book"></i>
                <span>Qu·∫£n l√Ω s√°ch</span>
            </a>
            <a href="admin-users.html" class="admin-nav-item">
                <i class="fas fa-users"></i>
                <span>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</span>
            </a>
            <a href="admin-categories.html" class="admin-nav-item">
                <i class="fas fa-tags"></i>
                <span>Qu·∫£n l√Ω th·ªÉ lo·∫°i</span>
            </a>
            <a href="admin-authors.html" class="admin-nav-item">
                <i class="fas fa-user-pen"></i>
                <span>Qu·∫£n l√Ω t√°c gi·∫£</span>
            </a>
            <a href="admin-orders.html" class="admin-nav-item">
                <i class="fas fa-shopping-cart"></i>
                <span>Qu·∫£n l√Ω ƒë∆°n h√†ng</span>
            </a>
            <a href="admin-reviews.html" class="admin-nav-item">
                <i class="fas fa-star"></i>
                <span>Qu·∫£n l√Ω ƒë√°nh gi√°</span>
            </a>
            <div class="admin-nav-divider"></div>
            <a href="index.html" class="admin-nav-item">
                <i class="fas fa-home"></i>
                <span>V·ªÅ trang ch·ªß</span>
            </a>
            <a href="#" class="admin-nav-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>ƒêƒÉng xu·∫•t</span>
            </a>
        </nav>
    </aside>

    <div class="admin-content-wrapper">
        <header class="admin-header">
            <div class="admin-header__left">
                <button class="admin-sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="admin-breadcrumb">
                    <span>B·∫£ng ƒëi·ªÅu khi·ªÉn</span>
                    <i class="fas fa-angle-right"></i>
                    <strong>Books Management</strong>
                </div>
            </div>
            <div class="admin-header__right">
                <button class="admin-btn ghost" id="exportBooksBtn">
                    <i class="fas fa-download"></i> Export JSON
                </button>
                <div class="admin-user">
                    <div class="admin-user__avatar">AD</div>
                    <div class="admin-user__info">
                        <strong>Admin</strong>
                        <span>Superuser</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="admin-main">
            <section class="panel form-panel">
                <div class="panel__header">
                    <div>
                        <h2>Th√™m / ch·ªânh s·ª≠a s√°ch</h2>
                        <p>Upload file truy·ªán (.doc, .docx, .txt) + b√¨a PNG/JPG</p>
                    </div>
                    <button class="admin-btn ghost" id="resetFormBtn">
                        <i class="fas fa-rotate"></i> L√†m m·ªõi
                    </button>
                </div>

                <form id="bookForm" class="book-form">
                    <input type="hidden" id="bookId">
                    
                    <!-- Basic Info Section -->
                    <div class="form-section">
                        <h3 class="form-section__title">üìñ Th√¥ng tin c∆° b·∫£n</h3>
                        <div class="form-grid">
                            <label class="form-control">
                                <span>Ti√™u ƒë·ªÅ *</span>
                                <input type="text" id="title" required placeholder="Nh·∫≠p t√™n truy·ªán">
                            </label>
                            <label class="form-control">
                                <span>T√°c gi·∫£ *</span>
                                <div style="display:flex;gap:8px;align-items:flex-start">
                                    <div style="flex:1">
                                        <select id="author" required style="width:100%">
                                            <option value="">-- Ch·ªçn t√°c gi·∫£ --</option>
                                        </select>
                                    </div>
                                    <button type="button" id="btnShowNewAuthor" class="admin-btn tiny primary" title="Th√™m t√°c gi·∫£ m·ªõi">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <!-- Inline Author Creation Form -->
                                <div id="newAuthorForm" style="display:none;margin-top:12px;padding:12px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;">
                                    <h4 style="margin:0 0 10px 0;font-size:14px">‚ûï Th√™m t√°c gi·∫£ m·ªõi</h4>
                                    <input type="text" id="newAuthorName" placeholder="T√™n t√°c gi·∫£" style="width:100%;margin-bottom:8px;padding:8px;border:1px solid #d1d5db;border-radius:4px" />
                                    <textarea id="newAuthorDesc" placeholder="M√¥ t·∫£ (tu·ª≥ ch·ªçn)" rows="2" style="width:100%;margin-bottom:8px;padding:8px;border:1px solid #d1d5db;border-radius:4px;resize:vertical"></textarea>
                                    <div style="margin-bottom:8px">
                                        <label style="display:block;margin-bottom:4px;font-size:12px">·∫¢nh ƒë·∫°i di·ªán (tu·ª≥ ch·ªçn)</label>
                                        <input type="file" id="newAuthorImage" accept="image/*" style="font-size:12px" />
                                    </div>
                                    <div style="display:flex;gap:8px;">
                                        <button type="button" id="createAuthorBtn" class="admin-btn primary" style="flex:1">
                                            <i class="fas fa-check"></i> T·∫°o t√°c gi·∫£
                                        </button>
                                        <button type="button" id="cancelCreateAuthor" class="admin-btn ghost">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Description Section -->
                    <div class="form-section">
                        <h3 class="form-section__title">üìù M√¥ t·∫£</h3>
                        <label class="form-control">
                            <span>T√≥m t·∫Øt n·ªôi dung</span>
                            <textarea id="description" rows="4" placeholder="Vi·∫øt m√¥ t·∫£ chi ti·∫øt v·ªÅ s√°ch. ƒêi·ªÅu n√†y s·∫Ω hi·ªÉn th·ªã khi ng∆∞·ªùi d√πng xem chi ti·∫øt s√°ch."></textarea>
                        </label>
                    </div>

                    <!-- Category Section -->
                    <div class="form-section">
                        <h3 class="form-section__title">üè∑Ô∏è Ph√¢n lo·∫°i</h3>
                        <label class="form-control">
                            <span>Th·ªÉ lo·∫°i *</span>
                            <div style="display:flex;gap:8px;align-items:flex-start">
                                <div style="flex:1">
                                    <select id="category" required multiple size="5" style="min-height:120px;padding:8px;width:100%">
                                        <option value="">-- Ch·ªçn th·ªÉ lo·∫°i --</option>
                                    </select>
                                </div>
                                <button type="button" id="btnShowNewCategory" class="admin-btn tiny primary" title="Th√™m th·ªÉ lo·∫°i m·ªõi">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <!-- Inline Category Creation Form -->
                            <div id="newCategoryForm" style="display:none;margin-top:12px;padding:12px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;">
                                <h4 style="margin:0 0 10px 0;font-size:14px">‚ûï Th√™m th·ªÉ lo·∫°i m·ªõi</h4>
                                <input type="text" id="newCategoryName" placeholder="T√™n th·ªÉ lo·∫°i" style="width:100%;margin-bottom:8px;padding:8px;border:1px solid #d1d5db;border-radius:4px" />
                                <div style="display:flex;gap:8px;">
                                    <button type="button" id="createCategoryBtn" class="admin-btn primary" style="flex:1">
                                        <i class="fas fa-check"></i> T·∫°o th·ªÉ lo·∫°i
                                    </button>
                                    <button type="button" id="cancelCreateCategory" class="admin-btn ghost">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <small style="color:#6b7280;margin-top:8px;display:block">üí° Gi·ªØ Ctrl (Cmd tr√™n Mac) ƒë·ªÉ ch·ªçn nhi·ªÅu th·ªÉ lo·∫°i</small>
                        </label>
                    </div>

                    <!-- Files Section -->
                    <div class="form-section">
                        <h3 class="form-section__title">üìÇ T·∫£i t·∫≠p tin</h3>
                        <div class="upload-grid">
                            <div class="upload-card">
                                <div class="upload-card__header">
                                    <div>
                                        <h4>üìÑ File truy·ªán</h4>
                                        <p>.doc, .docx, .txt - t·ªëi ƒëa 20MB</p>
                                    </div>
                                    <button type="button" class="admin-btn tiny ghost" id="previewBookFileBtn" title="Xem th√¥ng tin file">
                                        <i class="fas fa-info-circle"></i>
                                    </button>
                                </div>
                                <label class="file-drop" for="bookFile">
                                    <input type="file" id="bookFile" accept=".doc,.docx,.txt,.pdf">
                                    <i class="fas fa-file-pdf" style="font-size:32px;color:#dc2626"></i>
                                    <p>K√©o th·∫£ ho·∫∑c ch·ªçn file</p>
                                    <small id="bookFileInfo">Ch∆∞a c√≥ file</small>
                                </label>
                            </div>

                            <div class="upload-card">
                                <div class="upload-card__header">
                                    <div>
                                        <h4>üñºÔ∏è B√¨a s√°ch</h4>
                                        <p>PNG, JPG, JPEG - t·ªëi ƒëa 5MB</p>
                                    </div>
                                    <button type="button" class="admin-btn tiny ghost" id="previewCoverBtn" title="Xem b√¨a s√°ch">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <label class="file-drop" for="coverFile">
                                    <input type="file" id="coverFile" accept=".png,.jpg,.jpeg,.webp">
                                    <i class="fas fa-image" style="font-size:32px;color:#3b82f6"></i>
                                    <p>K√©o th·∫£ ho·∫∑c ch·ªçn ·∫£nh</p>
                                    <small id="coverFileInfo">Ch∆∞a c√≥ ·∫£nh</small>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="submit" class="admin-btn primary" id="submitBtn" style="flex:1">
                            <i class="fas fa-plus-circle"></i>
                            <span>Th√™m m·ªõi</span>
                        </button>
                        <button type="button" class="admin-btn ghost" id="resetFormBtn">
                            <i class="fas fa-rotate-left"></i> L√†m m·ªõi
                        </button>
                    </div>
                </form>
            </section>

            <section class="panel table-panel">
                <div class="panel__header">
                    <div>
                        <h2>Danh s√°ch s√°ch</h2>
                        <p>Qu·∫£n l√Ω v√† theo d√µi to√†n b·ªô truy·ªán ƒë√£ upload</p>
                    </div>
                    <div class="table-actions">
                        <label class="search-input">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchInput" placeholder="T√¨m theo t√™n, t√°c gi·∫£...">
                        </label>
                        <select id="filterCategory">
                            <option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
                        </select>
                    </div>
                </div>

                <div class="table-wrapper">
                    <!-- S·ª¨A: ƒê·∫∑t l·∫°i c·∫•u tr√∫c b·∫£ng v·ªõi ƒë·ªô r·ªông c·ªë ƒë·ªãnh -->
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="text-align: left; border-bottom: 2px solid #eee;">
                                <th style="width: 35%; padding: 12px;">S√°ch</th>
                                <th style="width: 15%; padding: 12px;">T√°c gi·∫£</th>
                                <th style="width: 15%; padding: 12px;">Th·ªÉ lo·∫°i</th>
                                <th style="width: 15%; padding: 12px;">File</th>
                                <th style="width: 10%; padding: 12px;">Ng√†y t·∫°o</th>
                                <th style="width: 10%; padding: 12px;">H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="booksTableBody">
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <i class="fas fa-inbox"></i>
                                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <aside class="panel preview-panel" id="metadataPanel">
                <div class="panel__header">
                    <div>
                        <h2>Preview metadata</h2>
                        <p>Chi ti·∫øt file ƒë∆∞·ª£c ch·ªçn</p>
                    </div>
                    <button class="admin-btn tiny ghost" id="clearPreviewBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="metadata-content" id="metadataContent">
                    <div class="metadata-empty">
                        <i class="fas fa-magnifying-glass"></i>
                        <p>Ch·ªçn s√°ch ho·∫∑c file ƒë·ªÉ xem metadata</p>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <div class="toast" id="toast"></div>

    <!-- S·ª¨A: Template kh·ªõp ho√†n to√†n v·ªõi b·∫£ng -->
    <template id="bookRowTemplate">
        <tr style="border-bottom: 1px solid #f0f0f0;">
            <!-- C·ªôt 1: S√°ch -->
            <td style="padding: 12px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <img src="" alt="" class="book-cover" 
                         style="width: 45px; height: 65px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;">
                    <div>
                        <strong class="book-title" style="display: block; font-size: 14px; color: #333;">Title</strong>
                        <p class="book-description" style="font-size: 12px; color: #666; margin: 0; max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Desc</p>
                    </div>
                </div>
            </td>
            
            <!-- C·ªôt 2: T√°c gi·∫£ -->
            <td style="padding: 12px;">
                <span class="book-author" style="font-weight: 500; color: #2563eb;">Author</span>
            </td>
            
            <!-- C·ªôt 3: Th·ªÉ lo·∫°i -->
            <td style="padding: 12px;">
                <span class="category-chip" style="background: #f3f4f6; padding: 4px 8px; border-radius: 12px; font-size: 12px; display: inline-block;">Category</span>
            </td>
            
            <!-- C·ªôt 4: File -->
            <td style="padding: 12px;">
                <a href="#" target="_blank" class="book-file" style="font-size: 12px; color: #2563eb; text-decoration: underline;">filename</a>
            </td>
            
            <!-- C·ªôt 5: Ng√†y t·∫°o -->
            <td style="padding: 12px;">
                <span class="book-created" style="font-size: 13px;">Date</span>
            </td>
            
            <!-- C·ªôt 6: N√∫t b·∫•m -->
            <td style="padding: 12px;">
                <div style="display: flex; gap: 8px;">
                    <button class="icon-btn preview" data-action="preview" title="Xem" style="background:none; border:none; cursor:pointer; color:#6b7280;"><i class="fas fa-eye"></i></button>
                    <button class="icon-btn edit" data-action="edit" title="S·ª≠a" style="background:none; border:none; cursor:pointer; color:#2563eb;"><i class="fas fa-pen"></i></button>
                    <button class="icon-btn delete" data-action="delete" title="X√≥a" style="background:none; border:none; cursor:pointer; color:#dc2626;"><i class="fas fa-trash"></i></button>
                </div>
            </td>
        </tr>
    </template>

    <script type="module" src="../js/utils.js"></script>
<script type="module" src="../js/api.js"></script>
<!-- Admin books c≈©ng n√™n ƒë·ªÉ module ƒë·ªÉ ƒë·∫£m b·∫£o n√≥ ch·∫°y SAU khi api.js t·∫£i xong -->
<script type="module" src="../js/admin-books.js"></script>
</body>
</html>